# 이벤트루프(Event Loop)
📌 드림코딩

📌 모던자바스크립트 Deep Dive

<br>

### 동기 처리와 비동기 처리

- **프로세스(Process)란?** 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램
- **쓰레드(Thread)란?** 어떠한 프로그램 내에서, 특히 프로세스 내에서 실행되는 흐름의 단위
    - 보통 하나의 쓰레드를 가짐
    - 여러개의 쓰레드를 동시에 실행할 수 도 있음 - multithread
    - 한 프로세스 안에서 code, data, heap을 공유함

<br>

**메모리 구성**

- 어플리케션을 구동하는, 개발자가 작성한 **code**
- 어플리케이션에서 전반적으로 필요한 변수 **data**
- 어플리케이션을 실행하는 순서, 실행순서를 보관하는 **stack**
- 단순한 데이터가 아닌 복잡한 데이터타입인 객체를 보관하고 할당되는 **heap**

<br>

### 동기 처리

- 함수를 호출하면 평가되어 실행 컨텍스트가 생성된다.
- 생성된 함수 실행 컨텍스트는 콜스택(Call Stack)에 푸시(push)되고 함수 코드가 실행된다.
- 함수의 실행이 종료되면 실행 컨텍스트는 콜스택(Call Stack)에서 팝(pop)되어 제거된다.
- 콜스택(Call Stack) : LIFO(Last In First Out) 라고 부르는 자료구조, 제일 나중에 들어온것이 제일 처음으로 나간다는 뜻
- 자바스크립트 엔진은 단하나의 콜스택을 갖는다.
- 즉 한번에 하나의 태스크만 실행할 수 있는 싱글 스레드(single thread)방식으로 동작한다.
- 처리에 시간이 걸리는 태스크를 실행하는 경우 블로킹(작업중단)이 발생한다.
- 동기처리 방식은 태스크를 순서대로 하나씩 처리하므로 실행 순서가 보장된다는 장점이 있지만, 앞선 태스크가 종료될 때까지 이후 태스크들이 블로킹 되는 단점이 있다.

<br>

### 비동기 처리

- 현재 실행 중인 태스크가 종료 되지 않은 상태라 해도 다음 태스크를 곧바로 실행하는 방식
- setTimeout, setInterval, HTTP요청, 이벤트 핸들러등

<br>

### 이벤트루프와 태스크 큐

- 브라우저는 많은 태스크가 동시에 처리되는 것 처럼 느껴진다.
- 자바스크립트의 동시성을 지원하는 것이 이벤트루프(Event Loop)이다.
- 브라우저에 내장되어 있는 기능
- 큐(queue) : FIFO(First In First Out) 라고 부르는 자료구조, 제일 처음 들어온 것이 제일 처음에 나가는 것
- 태스크큐(task queue) : 비동기 함수의 콜백함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
- 마이크로태스크큐(microtask queue) : 프로미스의 후속처리 메서드의 콜백함수가 일시적으로 보관되는 영역

<br>

📌 결론적으로 

<br>

자바스크립트엔진에 있는 콜스택은 한번에 하나의 일만 수행하며 실행순서를 기억한다. 

<br>

**한번에 여러가지를 동시에 실행할 수 있게 즉 비동기적으로 처리하려 어떻게 해야할까?**

* 자바스크립트 런타임 환경에서는 다양한 web API를 제공해주는데 이것을 사용하면 우리가 만든 콜백함수를 태스크큐에 넣어두게 된다. 

* 이때 이벤트루프가 콜스택과 태스크큐를 돌면서 콜스택이 비어져있는걸 발견하면 태스크큐에 있는 콜백함수를 콜스택에 넣어 실행하게 된다.  

<br>

**마이크로태스크큐와 태스크큐의 차이점**

* 이벤트루프가 돌면서 마이크로태스크큐 영역에 가면 그곳에 들어있는 모든 함수들이 실행한 다음에야 다시 이벤트 루프가 실행된다. 즉 계속 새로운 비동기함수를 만들어 내면 이벤트루프는 중단되어 실행되지 않는다. 

* 태스크큐는 한번에 하나만 실행하고 이벤트 루프가 실행된다. 즉 하나의 일을 수행하고 다음 함수가 있다 하더라도 실행되는 것이다. 

<br>

✨비동기 처리 방식 

콜스택에 있는 함수 실행 → 이벤트 루프 실행 → 렌더과정 처리 → 마이크로태스크큐 처리 → 태스크큐 처리 → 콜스택 확인 → 다시 과정 반복